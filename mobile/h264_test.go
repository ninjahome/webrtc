package webrtcLib

import (
	"encoding/hex"
	"fmt"
	"github.com/nareix/joy4/codec/h264parser"
	"github.com/ninjahome/webrtc/utils"
	"github.com/pion/webrtc/v3"
	"testing"
)

func TestParser(t *testing.T) {
	var typ int
	var nalus [][]byte

	annexbFrame, _ := hex.DecodeString("000000012742001fab405a050c80")
	fmt.Println(annexbFrame)
	nalus, typ = h264parser.SplitNALUs(annexbFrame)
	fmt.Println(typ, len(nalus))

	avccFrame, _ := hex.DecodeString("0000000128ce3c80")
	fmt.Println(avccFrame)

	nalus, typ = h264parser.SplitNALUs(avccFrame)
	fmt.Println(typ, len(nalus))

	annexbFrame2, _ := hex.DecodeString("5c819b2015af1b001f9072f9acbb7d221d68a96d7f7cd60254058bdbb6f2bff0c00565f71d85a8c6a055c20dada40ca9b0e4440ae652cdad140907a5ccb5087a3dde21ad31d8eccc08df93ac446000605fad82e459b968a1a181ecad883125ffd5045a8894d6d77dfcb51158b4856b52977f680683be2d5ebf44b0efdfde00154a3a8c4e7d75bd0907c04c4c038e7c77426c7f727a41cb88a5422e34145d14643442df8d80a065dcac6cdc526908fda05c5ed89b8decb47fdb42af5cb7d5479fffde830cce968dcd6d3b4bffb7008daab0e4de2a94812b5024c8dd3614ffedda4634b66a2b5696e601a2bc4d6ed7cd608244a53b0565e17bac435b4f795d57dda9b0d163c2af7fddf1407d3f9664fbfb8635d070f5c1f503c95fcd808c4744d4b635ea9057ea4e294435ec27b22a3d00e6b148df2ab28d3d8de4713a38bd71f7e370a88f73ffdcff2cda3f7c864ad5dfea0a66a3dfff3231d69aa703fd0c648ed6cbe5b22994b712fcdf3af0a9d8077b6dae3dfd0c755f12000153d25f3271c5dfb63d804a8b124fffb807e1f5454b64affff3600067720362272517cfdd0a10be3c1baa4320c29243b1e615037920f8881177c56c9d3c363c6c4a7dc3fb61ebbf7af0b01f1e7b75f6f3e74035125ebdd0f420143c342347960270cc81bea6d2bbaffa8246f2796f3bd604ca13e2634f5c0ff4a214ef4802982feb8381972cbc2fec12bb5cff7460632326686c9e1ea4800040024ea05134203c0c055030c812242dc48854d1384c4ffcc098b152e0811a4b074cba018e519443d89d4b131b01c956616e2e0615aa1e3602d81ab6e2b428515e12690275f820d1ce72cf3027359ac58cf384df9c13911e0041dace8cb7035c7f6fa2114546ff4035668c244ce7c8ff6fec270efbba508969327ed683edcf53d5b77da2444780c236cbfd0c7f8186407198697530b55c501c5da5f3bb6e64cfa9cd20516e478404514302aa46a7f22a75b4ffcc782a2cc07888d83419351d55a2dc3dd6a1c30d8b2d1470d7fbb9ca000665b8190257967a63ed340475aa39a722d03fefe7c52fdf09f361a334f2ab92f79987439df39caa039867bfc00401a70ce8b5b9e78dd1864aaef6855eaf5fe86964093d0fff7f5bfecc9bd1c7b400b316302790c45281b4f84064d12c381ce158e5a83a8fb82c57423207a1d53df0d3b6809f78dc1464df3c6c369bf3102a3b26eac53a83f80ed4b4dc72fe0bd3cf38514ca523bf7744ad76ea236f747653fd089998604086b5f47646dc0fff1b66e152084258156722780b30acf62fd798514bfecd21a37f8d94dbc729e64c0701797eb5e14ac09c82efb4500de027665ceeed184e2336a5f8db68192d3bf25748001a2a439538f84e3f977cab1896af6290f2644ed7effadb3025c8dea74efffae267b1c4fbffff39004acb1d254ffbdc5ed86721c09b91940749f07ff3a188bdf68f4c3e721704255a90fa70743543c08652a79d38b2ae0460b0b6ce1dd77c6d65de3ad9137f4ce4e9afa37fd36974c93dbb6fcf13913ad2216eca1eabad681de10e42116949d0b68917d4d9dc98ee43e1c1403537f6d5605b84be5d5cfeef4024b6b9bcaa91eb712a8b7864322bc182c4f03762a9cc1c05486827a428d9af8db48a4b3f0df235d3c2c7e74f0385bbfeff45f3")
	fmt.Println(annexbFrame2)
	nalus, typ = h264parser.SplitNALUs(annexbFrame2)
	fmt.Println(typ, len(nalus))

	avccFrame2, _ := hex.DecodeString(
		"7c85b800040000053ef1f870ea200729cad1fd5751d8e777f1f8e356975ebefb7ffe50c2d7bddff7ffd7e2ae2bcde4dfeb8df509c0bf0ab85b8a92560a7260b4be24fdeb6baa12d13feb511cd49af0ffc3a80e36126301169f71a32d407bd748d23c7b4a533b499f0985ebfc30fef179b81a2c0498788e7aebff1fc3b8a03efee9cb9c7e123537fb0ba47e8ade1a11f9e187f15802fd99820f44a93e0e1e2934c2c2551c7ae451ffff85e583ebfc7c9881e4dc98ac98af957d7079cf6d77bf7b4fb5eae3b42fffbdf12db68bb42f6cfab9f67092ce572681f356c30afbe957e9c8f7afe11ff8af5ccea50d0f2af3a7e15e37ed2f522895e24413353c709baf6f08e001a471afcf217dfe4ea02cbfd2d39d22532d17897167341f807e3fbf3b1aad7d7f01f840317cdd68d6d2ff061007c7c6546a91664cb5d1814d463c455d23bf6fd45d14b42cb42d4b2c8f7b2e5db19ad7dc98dbac7fe3f4f2713e4941ca97d6c7634fc7c35e3b2175272f2fd6b5ec4ff094506eab9b1223a45e7c755f670b13066edc87f4eaafea4a5e5d21ce3870ad57343242483a08b06fb9d05181303a385d8d8a6753790d5c9b391b63011b666aa3cace8cda5504aaa85a29464fef86a31aa64a79d7db9a13418e31b4ff107fbd447fd4df5baff0c06d4a08575e0eacd27e95d8f00b007b7852af526ec5c66a21ec395c7ce67a776b16e03718356286b35bd9db5332bfd3349f5729bb25706df0fed4fdcccd8cd73302bc903de48d876a1471fc61f860c3dd6274da5e5e4f22e3c7e90beaf2e6f988fc3ba9fffb6de230c0fcfff97f63355d7d78fa078017cdfc097eadba7cfa7c7fafafe1d4210f9fb4b5fab1e0f86fdf826f3634bff40038a9d6faaa6b68fdba82778c069d797c5323d28bf0d5d6d87c7b7e9f00ae00241e1703f4ab58cee142d97ad543472279c03f2fc5d3b513c6bd4629f270082780eea34d0fee5259d71aa21bbcf8fd998c83b196116843a8cbacba17eb5c7c2fff0961948235e80eaa0ed5e9f0ff7c56d197ec4c7fb1b191cd85eb362e157ffd0ff7fa8d794fcf0f7a4f0f5d3a13a3b448772dffe052c475555ebb42b8010f6e5447fabbffe5a47fbb91014243f9014ed8ce4cf558f8c509c98d0a6399fffd15ea10c2d0707fa7f757af3134b08d269e1f42abaaf6b8e3d7c3b00978141fe782bde19ac582bfd580d5afff28bfa17aeb8f66846f1ff5fa441709faaa8752738430ee37ebf5fbd863b000c0dfff717ffdc0f1b92beba95e8783949272eeb27ffff0825c0d832263efff877c223c1ef1450915629f00a2e3155fbff0fe93ad73f62f0e94f57dbf7851c22e543bfef67f686709154efffb6cebfd3f72e5202e43f2c45e2fd41660845912972ff85bf853f7bcd2ee3b4dbfe230886d1189a7bb6ba72b0a9dfcffd2342a1de59371fae830cd8f422e407281057c75cf99ff59fa3e98048f6bfe5fe1ffc5e17a35a79e0cc62946216cfacf84d0d527c21fb1aa25de5cd934e0e6f821749fac8c53771a46f99875c5d442294267ba6e8aec2c483200878b100f2231798971009bbd1a8bc7f221539c016c4fbc7640cc757287347ab1ebc26667f56523",
	)
	fmt.Println(avccFrame2)
	nalus, typ = h264parser.SplitNALUs(avccFrame2)
	fmt.Println(typ, len(nalus))
}
func TestCodec(t *testing.T) {
	var offer = `eyJ0eXBlIjoib2ZmZXIiLCJzZHAiOiJ2PTBcclxubz0tIDI0Mzk0MTU0NDEwNDU2MzMwMCAxNjkyNDMxODc1IElOIElQNCAwLjAuMC4wXHJcbnM9LVxyXG50PTAgMFxyXG5hPWZpbmdlcnByaW50OnNoYS0yNTYgQTE6MDU6RTk6MUI6NDE6RTI6N0I6NkU6MkY6NTM6NjU6QjI6NDU6ODU6MTQ6NEY6QUY6MDg6OTc6RDM6Qzc6N0I6M0M6RTQ6MUQ6Njk6NDM6MEI6QjE6NEU6NDM6MTdcclxuYT1leHRtYXAtYWxsb3ctbWl4ZWRcclxuYT1ncm91cDpCVU5ETEUgMCAxIDIgM1xyXG5tPXZpZGVvIDkgVURQL1RMUy9SVFAvU0FWUEYgMTI1XHJcbmM9SU4gSVA0IDAuMC4wLjBcclxuYT1zZXR1cDphY3RwYXNzXHJcbmE9bWlkOjBcclxuYT1pY2UtdWZyYWc6cmpTVmxWeVhid21yUFNlV1xyXG5hPWljZS1wd2Q6SEtDT3FHb0FIV3NLd3B4RFFPYmJUTXRiUFBrYmFzTnZcclxuYT1ydGNwLW11eFxyXG5hPXJ0Y3AtcnNpemVcclxuYT1ydHBtYXA6MTI1IEgyNjQvOTAwMDBcclxuYT1mbXRwOjEyNSBsZXZlbC1hc3ltbWV0cnktYWxsb3dlZD0xO3BhY2tldGl6YXRpb24tbW9kZT0xO3Byb2ZpbGUtbGV2ZWwtaWQ9NDJlMDFmXHJcbmE9c3NyYzo2NzA5OTIzOTEgY25hbWU6aGxZcnBoaFdmdm5ZeEx0TlxyXG5hPXNzcmM6NjcwOTkyMzkxIG1zaWQ6aGxZcnBoaFdmdm5ZeEx0TiBXS3VVenduZ2d6cUJJSkhQXHJcbmE9c3NyYzo2NzA5OTIzOTEgbXNsYWJlbDpobFlycGhoV2Z2bll4THROXHJcbmE9c3NyYzo2NzA5OTIzOTEgbGFiZWw6V0t1VXp3bmdnenFCSUpIUFxyXG5hPW1zaWQ6aGxZcnBoaFdmdm5ZeEx0TiBXS3VVenduZ2d6cUJJSkhQXHJcbmE9c2VuZHJlY3ZcclxuYT1jYW5kaWRhdGU6MzAwNzIyMzMzMyAxIHVkcCAyMTMwNzA2NDMxIDE5Mi4xNjguMS4xMDYgNTcyMDIgdHlwIGhvc3RcclxuYT1jYW5kaWRhdGU6MzAwNzIyMzMzMyAyIHVkcCAyMTMwNzA2NDMxIDE5Mi4xNjguMS4xMDYgNTcyMDIgdHlwIGhvc3RcclxuYT1jYW5kaWRhdGU6MjAzMjQxNTkzMyAxIHVkcCAyMTMwNzA2NDMxIDE2OS4yNTQuMTgxLjIwOSA1Njk5NSB0eXAgaG9zdFxyXG5hPWNhbmRpZGF0ZToyMDMyNDE1OTMzIDIgdWRwIDIxMzA3MDY0MzEgMTY5LjI1NC4xODEuMjA5IDU2OTk1IHR5cCBob3N0XHJcbmE9Y2FuZGlkYXRlOjIyODU3MDU4MjkgMSB1ZHAgMTY5NDQ5ODgxNSAyMTguMjQxLjIyMC41OCA2MTI3MyB0eXAgc3JmbHggcmFkZHIgMC4wLjAuMCBycG9ydCA2MTI3M1xyXG5hPWNhbmRpZGF0ZToyMjg1NzA1ODI5IDIgdWRwIDE2OTQ0OTg4MTUgMjE4LjI0MS4yMjAuNTggNjEyNzMgdHlwIHNyZmx4IHJhZGRyIDAuMC4wLjAgcnBvcnQgNjEyNzNcclxuYT1lbmQtb2YtY2FuZGlkYXRlc1xyXG5tPWF1ZGlvIDkgVURQL1RMUy9SVFAvU0FWUEYgMTExXHJcbmM9SU4gSVA0IDAuMC4wLjBcclxuYT1zZXR1cDphY3RwYXNzXHJcbmE9bWlkOjFcclxuYT1pY2UtdWZyYWc6cmpTVmxWeVhid21yUFNlV1xyXG5hPWljZS1wd2Q6SEtDT3FHb0FIV3NLd3B4RFFPYmJUTXRiUFBrYmFzTnZcclxuYT1ydGNwLW11eFxyXG5hPXJ0Y3AtcnNpemVcclxuYT1ydHBtYXA6MTExIG9wdXMvNDgwMDAvMlxyXG5hPWZtdHA6MTExIG1pbnB0aW1lPTEwO3VzZWluYmFuZGZlYz0xXHJcbmE9c3NyYzozMzI5ODUxMjc4IGNuYW1lOkVCZUlYUXZyS2x6SGpJZkJcclxuYT1zc3JjOjMzMjk4NTEyNzggbXNpZDpFQmVJWFF2cktsekhqSWZCIHFIU3hqU1BxakxTUGVGZU1cclxuYT1zc3JjOjMzMjk4NTEyNzggbXNsYWJlbDpFQmVJWFF2cktsekhqSWZCXHJcbmE9c3NyYzozMzI5ODUxMjc4IGxhYmVsOnFIU3hqU1BxakxTUGVGZU1cclxuYT1tc2lkOkVCZUlYUXZyS2x6SGpJZkIgcUhTeGpTUHFqTFNQZUZlTVxyXG5hPXNlbmRyZWN2XHJcbm09dmlkZW8gOSBVRFAvVExTL1JUUC9TQVZQRiAxMjVcclxuYz1JTiBJUDQgMC4wLjAuMFxyXG5hPXNldHVwOmFjdHBhc3NcclxuYT1taWQ6MlxyXG5hPWljZS11ZnJhZzpyalNWbFZ5WGJ3bXJQU2VXXHJcbmE9aWNlLXB3ZDpIS0NPcUdvQUhXc0t3cHhEUU9iYlRNdGJQUGtiYXNOdlxyXG5hPXJ0Y3AtbXV4XHJcbmE9cnRjcC1yc2l6ZVxyXG5hPXJ0cG1hcDoxMjUgSDI2NC85MDAwMFxyXG5hPWZtdHA6MTI1IGxldmVsLWFzeW1tZXRyeS1hbGxvd2VkPTE7cGFja2V0aXphdGlvbi1tb2RlPTE7cHJvZmlsZS1sZXZlbC1pZD00MmUwMWZcclxuYT1zc3JjOjM5ODUwMTU4NDcgY25hbWU6NzMzM2Y0M2QtZjFiOC00MjU5LWE5MDAtNWNlYTM1Yzc0MTBiXHJcbmE9c3NyYzozOTg1MDE1ODQ3IG1zaWQ6MDg3MGFiNzEtMTFjZi00YjA0LTk2ZTktMWJmYzA2MjVmNGM4IDM4Zjk5ODRkLWNkN2QtNDdjYy04ODdjLTJlMjViMDM1Y2UwY1xyXG5hPXNzcmM6Mzk4NTAxNTg0NyBtc2xhYmVsOjA4NzBhYjcxLTExY2YtNGIwNC05NmU5LTFiZmMwNjI1ZjRjOFxyXG5hPXNzcmM6Mzk4NTAxNTg0NyBsYWJlbDozOGY5OTg0ZC1jZDdkLTQ3Y2MtODg3Yy0yZTI1YjAzNWNlMGNcclxuYT1tc2lkOjNlY2I3MGRiLTgyMTUtNGRiMS1hNjE3LTFlMGQ4NmMxM2EyNSAzOGY5OTg0ZC1jZDdkLTQ3Y2MtODg3Yy0yZTI1YjAzNWNlMGNcclxuYT1zZW5kcmVjdlxyXG5tPWF1ZGlvIDkgVURQL1RMUy9SVFAvU0FWUEYgMTExXHJcbmM9SU4gSVA0IDAuMC4wLjBcclxuYT1zZXR1cDphY3RwYXNzXHJcbmE9bWlkOjNcclxuYT1pY2UtdWZyYWc6cmpTVmxWeVhid21yUFNlV1xyXG5hPWljZS1wd2Q6SEtDT3FHb0FIV3NLd3B4RFFPYmJUTXRiUFBrYmFzTnZcclxuYT1ydGNwLW11eFxyXG5hPXJ0Y3AtcnNpemVcclxuYT1ydHBtYXA6MTExIG9wdXMvNDgwMDAvMlxyXG5hPWZtdHA6MTExIG1pbnB0aW1lPTEwO3VzZWluYmFuZGZlYz0xXHJcbmE9c3NyYzozNTAzMDYxMzk2IGNuYW1lOjI2MmFlNzEwLWI0OTktNDAzZC04MTdlLTE3ZWM0NDYyYzIzZlxyXG5hPXNzcmM6MzUwMzA2MTM5NiBtc2lkOjVkYWM0ODBmLTBlMjItNDhjOC1hNzhiLTlmMzhiNTEwOWVmNiA0ZWFlZjQwMC0wMzQ5LTQ0OTAtOTI2Zi03NjI3MjU5NzI3ZGFcclxuYT1zc3JjOjM1MDMwNjEzOTYgbXNsYWJlbDo1ZGFjNDgwZi0wZTIyLTQ4YzgtYTc4Yi05ZjM4YjUxMDllZjZcclxuYT1zc3JjOjM1MDMwNjEzOTYgbGFiZWw6NGVhZWY0MDAtMDM0OS00NDkwLTkyNmYtNzYyNzI1OTcyN2RhXHJcbmE9bXNpZDozNGFjOGEyZC0wNTg4LTRhNmYtOWI2NC1lODQ5NDZjYmYxNTQgNGVhZWY0MDAtMDM0OS00NDkwLTkyNmYtNzYyNzI1OTcyN2RhXHJcbmE9c2VuZHJlY3ZcclxuIn0=`
	var offer_sdp = &webrtc.SessionDescription{}
	utils.Decode(offer, offer_sdp)
	fmt.Println(offer_sdp)

	var anwser = `eyJ0eXBlIjoiYW5zd2VyIiwic2RwIjoidj0wXHJcbm89LSA4MzgwNzU1OTk4OTMwOTI0MDMgMTY5MjQzMjAyNyBJTiBJUDQgMC4wLjAuMFxyXG5zPS1cclxudD0wIDBcclxuYT1maW5nZXJwcmludDpzaGEtMjU2IDRCOjgyOjdBOjZEOkI0OkVCOjVEOjEyOjk4OjE1OkNBOjEzOkQ2Ojg4OkNFOjkwOkE5OjEyOjNCOkIyOkUzOkRGOjk2OjVCOjMyOkQ5OkIyOjNBOjg5OkI2Ojc3OjhBXHJcbmE9ZXh0bWFwLWFsbG93LW1peGVkXHJcbmE9Z3JvdXA6QlVORExFIDAgMlxyXG5tPXZpZGVvIDkgVURQL1RMUy9SVFAvU0FWUEYgMTI1XHJcbmM9SU4gSVA0IDAuMC4wLjBcclxuYT1zZXR1cDphY3RpdmVcclxuYT1taWQ6MFxyXG5hPWljZS11ZnJhZzp0TUxJUWdLWVhicW9jUXNaXHJcbmE9aWNlLXB3ZDpnQ3VJQm5sa25jaGNlblRFcllWSGpSanpkamJOSVBGZVxyXG5hPXJ0Y3AtbXV4XHJcbmE9cnRjcC1yc2l6ZVxyXG5hPXJ0cG1hcDoxMjUgSDI2NC85MDAwMFxyXG5hPWZtdHA6MTI1IGxldmVsLWFzeW1tZXRyeS1hbGxvd2VkPTE7cGFja2V0aXphdGlvbi1tb2RlPTE7cHJvZmlsZS1sZXZlbC1pZD00MmUwMWZcclxuYT1zc3JjOjI1NzkyODAxMzQgY25hbWU6bmluamFcclxuYT1zc3JjOjI1NzkyODAxMzQgbXNpZDpuaW5qYSB2aWRlb1xyXG5hPXNzcmM6MjU3OTI4MDEzNCBtc2xhYmVsOm5pbmphXHJcbmE9c3NyYzoyNTc5MjgwMTM0IGxhYmVsOnZpZGVvXHJcbmE9bXNpZDpuaW5qYSB2aWRlb1xyXG5hPXNlbmRyZWN2XHJcbmE9Y2FuZGlkYXRlOjI2Mzc4NDAxMTAgMSB1ZHAgMjEzMDcwNjQzMSAxNjkuMjU0LjIxMy4xMiA2NDUwOCB0eXAgaG9zdFxyXG5hPWNhbmRpZGF0ZToyNjM3ODQwMTEwIDIgdWRwIDIxMzA3MDY0MzEgMTY5LjI1NC4yMTMuMTIgNjQ1MDggdHlwIGhvc3RcclxuYT1jYW5kaWRhdGU6MjA3ODE1MzA0NSAxIHVkcCAyMTMwNzA2NDMxIDE5Mi4xNjguMS4xMDMgNjEwNDQgdHlwIGhvc3RcclxuYT1jYW5kaWRhdGU6MjA3ODE1MzA0NSAyIHVkcCAyMTMwNzA2NDMxIDE5Mi4xNjguMS4xMDMgNjEwNDQgdHlwIGhvc3RcclxuYT1jYW5kaWRhdGU6MjI4NTcwNTgyOSAxIHVkcCAxNjk0NDk4ODE1IDIxOC4yNDEuMjIwLjU4IDU4MzcxIHR5cCBzcmZseCByYWRkciAwLjAuMC4wIHJwb3J0IDU4MzcxXHJcbmE9Y2FuZGlkYXRlOjIyODU3MDU4MjkgMiB1ZHAgMTY5NDQ5ODgxNSAyMTguMjQxLjIyMC41OCA1ODM3MSB0eXAgc3JmbHggcmFkZHIgMC4wLjAuMCBycG9ydCA1ODM3MVxyXG5hPWVuZC1vZi1jYW5kaWRhdGVzXHJcbm09YXVkaW8gMCBVRFAvVExTL1JUUC9TQVZQRiAwXHJcbmM9SU4gSVA0IDAuMC4wLjBcclxubT12aWRlbyA5IFVEUC9UTFMvUlRQL1NBVlBGIDEyNVxyXG5jPUlOIElQNCAwLjAuMC4wXHJcbmE9c2V0dXA6YWN0aXZlXHJcbmE9bWlkOjJcclxuYT1pY2UtdWZyYWc6dE1MSVFnS1lYYnFvY1FzWlxyXG5hPWljZS1wd2Q6Z0N1SUJubGtuY2hjZW5URXJZVkhqUmp6ZGpiTklQRmVcclxuYT1ydGNwLW11eFxyXG5hPXJ0Y3AtcnNpemVcclxuYT1ydHBtYXA6MTI1IEgyNjQvOTAwMDBcclxuYT1mbXRwOjEyNSBsZXZlbC1hc3ltbWV0cnktYWxsb3dlZD0xO3BhY2tldGl6YXRpb24tbW9kZT0xO3Byb2ZpbGUtbGV2ZWwtaWQ9NDJlMDFmXHJcbmE9cmVjdm9ubHlcclxubT1hdWRpbyAwIFVEUC9UTFMvUlRQL1NBVlBGIDBcclxuYz1JTiBJUDQgMC4wLjAuMFxyXG4ifQ==`
	var anwser_sdp = &webrtc.SessionDescription{}
	utils.Decode(anwser, anwser_sdp)
	fmt.Println(anwser_sdp)
}
